#! /usr/bin/env python3

# n valore comune dati presi dall'es!
n = 11854178668350132536998770600021775412418919136267711466659575504833480429106340292308672916005731985811172925720279068992464220293573546887342858910065901
ea = 65537
da = 2454147980105506786425977989549345389561620074780357800626167210119179432413932079707729534686888191626633148799840568097408265451820012752747703117155329

eb = 5
ctb = 11221865015245352586827949926936479339872912906868036678060873700351121339721754353868819679643501748382626251386036804928304376365191637409698833040968724
# FINE DATI

# IMPORT QUA
from math import sqrt
from Crypto.Util.number import GCD
# from utilities import hexToStr

# qui ho tutti i phi possibili che ho trovato con get Possibilephi()
a = [329282740787503681583299183333938205900525531562991985184988208467596678586281173651658867504370150793195297499212098957104636507705893310601796341041439, 17451985261737695123914856716698724912727853172838575214804375048782623965072902203537919977731617992039350767458241244726545734908412345461895206075196267, 987848222362511044749897550001814617701576594688975955554964625402790035758843520954976602513110452379585892497636296871313909523117679931805389023124317, 52355955785213085371744570150096174738183559518515725644413125146347871895218706610613759933194853976118052302374723734179637204725237036385685618225588801, 658565481575007363166598366667876411801051063125983970369976416935193357172562347303317735008740301586390594998424197914209273015411786621203592682082878, 34903970523475390247829713433397449825455706345677150429608750097565247930145804407075839955463235984078701534916482489453091469816824690923790412150392534, 1975696444725022089499795100003629235403153189377951911109929250805580071517687041909953205026220904759171784995272593742627819046235359863610778046248634, 104711911570426170743489140300192349476367119037031451288826250292695743790437413221227519866389707952236104604749447468359274409450474072771371236451177602, 1317130963150014726333196733335752823602102126251967940739952833870386714345124694606635470017480603172781189996848395828418546030823573242407185364165756, 69807941046950780495659426866794899650911412691354300859217500195130495860291608814151679910926471968157403069832964978906182939633649381847580824300785068, 3951392889450044178999590200007258470806306378755903822219858501611160143035374083819906410052441809518343569990545187485255638092470719727221556092497268, 209423823140852341486978280600384698952734238074062902577652500585391487580874826442455039732779415904472209209498894936718548818900948145542742472902355204, 2634261926300029452666393466671505647204204252503935881479905667740773428690249389213270940034961206345562379993696791656837092061647146484814370728331512, 139615882093901560991318853733589799301822825382708601718435000390260991720583217628303359821852943936314806139665929957812365879267298763695161648601570136, 7902785778900088357999180400014516941612612757511807644439717003222320286070748167639812820104883619036687139981090374970511276184941439454443112184994536, 418847646281704682973956561200769397905468476148125805155305001170782975161749652884910079465558831808944418418997789873437097637801896291085484945804710408, 5268523852600058905332786933343011294408408505007871762959811335481546857380498778426541880069922412691124759987393583313674184123294292969628741456663024, 279231764187803121982637707467179598603645650765417203436870000780521983441166435256606719643705887872629612279331859915624731758534597527390323297203140272, 15805571557800176715998360800029033883225225515023615288879434006444640572141496335279625640209767238073374279962180749941022552369882878908886224369989072, 837695292563409365947913122401538795810936952296251610310610002341565950323499305769820158931117663617888836837995579746874195275603792582170969891609420816, 10537047705200117810665573866686022588816817010015743525919622670963093714760997556853083760139844825382249519974787166627348368246588585939257482913326048, 558463528375606243965275414934359197207291301530834406873740001561043966882332870513213439287411775745259224558663719831249463517069195054780646594406280544, 31611143115600353431996721600058067766450451030047230577758868012889281144282992670559251280419534476146748559924361499882045104739765757817772448739978144, 1675390585126818731895826244803077591621873904592503220621220004683131900646998611539640317862235327235777673675991159493748390551207585164341939783218841632, 21074095410400235621331147733372045177633634020031487051839245341926187429521995113706167520279689650764499039949574333254696736493177171878514965826652096, 1116927056751212487930550829868718394414582603061668813747480003122087933764665741026426878574823551490518449117327439662498927034138390109561293188812561088, 63222286231200706863993443200116135532900902060094461155517736025778562288565985341118502560839068952293497119848722999764090209479531515635544897479956288, 3350781170253637463791652489606155183243747809185006441242440009366263801293997223079280635724470654471555347351982318987496781102415170328683879566437683264, 42148190820800471242662295466744090355267268040062974103678490683852374859043990227412335040559379301528998079899148666509393472986354343757029931653304192, 2233854113502424975861101659737436788829165206123337627494960006244175867529331482052853757149647102981036898234654879324997854068276780219122586377625122176, 126444572462401413727986886400232271065801804120188922311035472051557124577131970682237005121678137904586994239697445999528180418959063031271089794959912576, 6701562340507274927583304979212310366487495618370012882484880018732527602587994446158561271448941308943110694703964637974993562204830340657367759132875366528, 84296381641600942485324590933488180710534536080125948207356981367704749718087980454824670081118758603057996159798297333018786945972708687514059863306608384, 4467708227004849951722203319474873577658330412246675254989920012488351735058662964105707514299294205962073796469309758649995708136553560438245172755250244352, 252889144924802827455973772800464542131603608240377844622070944103114249154263941364474010243356275809173988479394891999056360837918126062542179589919825152, 13403124681014549855166609958424620732974991236740025764969760037465055205175988892317122542897882617886221389407929275949987124409660681314735518265750733056, 168592763283201884970649181866976361421069072160251896414713962735409499436175960909649340162237517206115992319596594666037573891945417375028119726613216768, 8935416454009699903444406638949747155316660824493350509979840024976703470117325928211415028598588411924147592938619517299991416273107120876490345510500488704, 505778289849605654911947545600929084263207216480755689244141888206228498308527882728948020486712551618347976958789783998112721675836252125084359179839650304, 26806249362029099710333219916849241465949982473480051529939520074930110410351977784634245085795765235772442778815858551899974248819321362629471036531501466112, 337185526566403769941298363733952722842138144320503792829427925470818998872351921819298680324475034412231984639193189332075147783890834750056239453226433536, 17870832908019399806888813277899494310633321648986701019959680049953406940234651856422830057197176823848295185877239034599982832546214241752980691021000977408, 1011556579699211309823895091201858168526414432961511378488283776412456996617055765457896040973425103236695953917579567996225443351672504250168718359679300608, 53612498724058199420666439833698482931899964946960103059879040149860220820703955569268490171591530471544885557631717103799948497638642725258942073063002932224]

for x in a:
	d = pow(eb, -1, x)
	plaintext = pow(ctb,d,n)
	plaintext = hex(plaintext)[2:]

# PHI GIUSTO 'E
phi = 1011556579699211309823895091201858168526414432961511378488283776412456996617055765457896040973425103236695953917579567996225443351672504250168718359679300608
d = pow(eb, -1, phi)
print(d)
check = pow(eb,-1,ea*da-1)
print(check)
plaintext = pow(ctb,pow(eb,-1,ea*da-1),n)
plaintext = hex(plaintext)[2:]
print(plaintext)
# print(hexToStr(plaintext))
# b'flag{rs4_1s_4_b34ut1ful_4lg0r1thm}'



# DIVISORI CHE HO TROVATO CON GETDIVISORI
piccoli =  [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3]
divisori = [7, 13, 31, 53, 283, 809, 139339, 162787, 2556678006341, 1691992786779815987183, 33621452595267019100053, 588405094990043507376419, 87548723979652479706398653739937280333427305889890783]

# function to generate all the sub lists
def sub_lists (l):
    base = []  
    lists = [base]
    for i in range(len(l)):
        orig = lists[:]
        new = l[i]
        for j in range(len(lists)):
            lists[j] = lists[j] + [new]
        lists = orig + lists
          
    return lists
  
# MAIN FUNCION@ MAIN MAIN MAIN GETTING THE PHIS!
def getPossiblePhi():
	divisori = sub_lists(divisori)
	possibilePhi = []
	for due in range(11):
		for tre in range(3):
			for x in divisori:
				phi = 2**due * 3**tre
				for number in x:
					phi *= number

				if pow(17,phi,n) == 1:
					possibilePhi.append(phi)
	print(len(possibilePhi))
	return possibilePhi

# getting least common divisor of all found phis, but it has bug in the reasoning, doesnt work...
def leastPhi(array):
	leastPhi = 2**1024
	for x in array:
		for i in array:
			commonDivisor = GCD(i,x)
			if  commonDivisor < leastPhi and commonDivisor != 1:
				leastPhi = commonDivisor

	print(leastPhi)
	return leastPhi

# https://www.alpertron.com.ar/ECM.HTM 
# trovati su questo sito, devo colamente cercare di parse il formato con cui me lo restituisce
def getDivisori():
	array = ['7', '13', '31', '53', '283', '809', '139339', '162787', '2 556678 006341', '1691 992786 779815 987183', '33621 452595 267019 100053', '588405 094990 043507 376419','87548 723979 652479 706398 653739 937280 333427 305889 890783' ]
	resArray = []


	for x in array:
		resArray.append(int("".join(x.split())))
	for x in range(10):
		resArray.append(2)

	for x in range(3):
		resArray.append(3)

	a = len(array)
	print(resArray)
	print(a*11*4)


# vedere se ho scomposto ed - 1 bene
def checkGoodDivision():
	check = 1
	for i in piccoli:
		check *= i
	for i in divisori:
		check *= i

	print(check == ea * da-1)
	return 

# avevo trovato un insieme di cosi che funzionavano e check ad elemnti comuni e bi, questa funzione non `e che serva tanto
def doubleCheck():
	a = [329282740787503681583299183333938205900525531562991985184988208467596678586281173651658867504370150793195297499212098957104636507705893310601796341041439, 17451985261737695123914856716698724912727853172838575214804375048782623965072902203537919977731617992039350767458241244726545734908412345461895206075196267, 987848222362511044749897550001814617701576594688975955554964625402790035758843520954976602513110452379585892497636296871313909523117679931805389023124317, 52355955785213085371744570150096174738183559518515725644413125146347871895218706610613759933194853976118052302374723734179637204725237036385685618225588801, 658565481575007363166598366667876411801051063125983970369976416935193357172562347303317735008740301586390594998424197914209273015411786621203592682082878, 34903970523475390247829713433397449825455706345677150429608750097565247930145804407075839955463235984078701534916482489453091469816824690923790412150392534, 1975696444725022089499795100003629235403153189377951911109929250805580071517687041909953205026220904759171784995272593742627819046235359863610778046248634, 104711911570426170743489140300192349476367119037031451288826250292695743790437413221227519866389707952236104604749447468359274409450474072771371236451177602, 1317130963150014726333196733335752823602102126251967940739952833870386714345124694606635470017480603172781189996848395828418546030823573242407185364165756, 69807941046950780495659426866794899650911412691354300859217500195130495860291608814151679910926471968157403069832964978906182939633649381847580824300785068, 3951392889450044178999590200007258470806306378755903822219858501611160143035374083819906410052441809518343569990545187485255638092470719727221556092497268, 209423823140852341486978280600384698952734238074062902577652500585391487580874826442455039732779415904472209209498894936718548818900948145542742472902355204, 2634261926300029452666393466671505647204204252503935881479905667740773428690249389213270940034961206345562379993696791656837092061647146484814370728331512, 139615882093901560991318853733589799301822825382708601718435000390260991720583217628303359821852943936314806139665929957812365879267298763695161648601570136, 7902785778900088357999180400014516941612612757511807644439717003222320286070748167639812820104883619036687139981090374970511276184941439454443112184994536, 418847646281704682973956561200769397905468476148125805155305001170782975161749652884910079465558831808944418418997789873437097637801896291085484945804710408, 5268523852600058905332786933343011294408408505007871762959811335481546857380498778426541880069922412691124759987393583313674184123294292969628741456663024, 279231764187803121982637707467179598603645650765417203436870000780521983441166435256606719643705887872629612279331859915624731758534597527390323297203140272, 15805571557800176715998360800029033883225225515023615288879434006444640572141496335279625640209767238073374279962180749941022552369882878908886224369989072, 837695292563409365947913122401538795810936952296251610310610002341565950323499305769820158931117663617888836837995579746874195275603792582170969891609420816, 10537047705200117810665573866686022588816817010015743525919622670963093714760997556853083760139844825382249519974787166627348368246588585939257482913326048, 558463528375606243965275414934359197207291301530834406873740001561043966882332870513213439287411775745259224558663719831249463517069195054780646594406280544, 31611143115600353431996721600058067766450451030047230577758868012889281144282992670559251280419534476146748559924361499882045104739765757817772448739978144, 1675390585126818731895826244803077591621873904592503220621220004683131900646998611539640317862235327235777673675991159493748390551207585164341939783218841632, 21074095410400235621331147733372045177633634020031487051839245341926187429521995113706167520279689650764499039949574333254696736493177171878514965826652096, 1116927056751212487930550829868718394414582603061668813747480003122087933764665741026426878574823551490518449117327439662498927034138390109561293188812561088, 63222286231200706863993443200116135532900902060094461155517736025778562288565985341118502560839068952293497119848722999764090209479531515635544897479956288, 3350781170253637463791652489606155183243747809185006441242440009366263801293997223079280635724470654471555347351982318987496781102415170328683879566437683264, 42148190820800471242662295466744090355267268040062974103678490683852374859043990227412335040559379301528998079899148666509393472986354343757029931653304192, 2233854113502424975861101659737436788829165206123337627494960006244175867529331482052853757149647102981036898234654879324997854068276780219122586377625122176, 126444572462401413727986886400232271065801804120188922311035472051557124577131970682237005121678137904586994239697445999528180418959063031271089794959912576, 6701562340507274927583304979212310366487495618370012882484880018732527602587994446158561271448941308943110694703964637974993562204830340657367759132875366528, 84296381641600942485324590933488180710534536080125948207356981367704749718087980454824670081118758603057996159798297333018786945972708687514059863306608384, 4467708227004849951722203319474873577658330412246675254989920012488351735058662964105707514299294205962073796469309758649995708136553560438245172755250244352, 252889144924802827455973772800464542131603608240377844622070944103114249154263941364474010243356275809173988479394891999056360837918126062542179589919825152, 13403124681014549855166609958424620732974991236740025764969760037465055205175988892317122542897882617886221389407929275949987124409660681314735518265750733056, 168592763283201884970649181866976361421069072160251896414713962735409499436175960909649340162237517206115992319596594666037573891945417375028119726613216768, 8935416454009699903444406638949747155316660824493350509979840024976703470117325928211415028598588411924147592938619517299991416273107120876490345510500488704, 505778289849605654911947545600929084263207216480755689244141888206228498308527882728948020486712551618347976958789783998112721675836252125084359179839650304, 26806249362029099710333219916849241465949982473480051529939520074930110410351977784634245085795765235772442778815858551899974248819321362629471036531501466112, 337185526566403769941298363733952722842138144320503792829427925470818998872351921819298680324475034412231984639193189332075147783890834750056239453226433536, 17870832908019399806888813277899494310633321648986701019959680049953406940234651856422830057197176823848295185877239034599982832546214241752980691021000977408, 1011556579699211309823895091201858168526414432961511378488283776412456996617055765457896040973425103236695953917579567996225443351672504250168718359679300608, 53612498724058199420666439833698482931899964946960103059879040149860220820703955569268490171591530471544885557631717103799948497638642725258942073063002932224]
	b = [219521827191669121055532788889292137267017021041994656789992138978397785724187449101105911669580100528796864999474732638069757671803928873734530894027626, 11634656841158463415943237811132483275151902115225716809869583365855082643381934802358613318487745328026233844972160829817697156605608230307930137383464178, 658565481575007363166598366667876411801051063125983970369976416935193357172562347303317735008740301586390594998424197914209273015411786621203592682082878, 34903970523475390247829713433397449825455706345677150429608750097565247930145804407075839955463235984078701534916482489453091469816824690923790412150392534, 1975696444725022089499795100003629235403153189377951911109929250805580071517687041909953205026220904759171784995272593742627819046235359863610778046248634, 104711911570426170743489140300192349476367119037031451288826250292695743790437413221227519866389707952236104604749447468359274409450474072771371236451177602, 439043654383338242111065577778584274534034042083989313579984277956795571448374898202211823339160201057593729998949465276139515343607857747469061788055252, 23269313682316926831886475622264966550303804230451433619739166731710165286763869604717226636975490656052467689944321659635394313211216460615860274766928356, 1317130963150014726333196733335752823602102126251967940739952833870386714345124694606635470017480603172781189996848395828418546030823573242407185364165756, 69807941046950780495659426866794899650911412691354300859217500195130495860291608814151679910926471968157403069832964978906182939633649381847580824300785068, 3951392889450044178999590200007258470806306378755903822219858501611160143035374083819906410052441809518343569990545187485255638092470719727221556092497268, 209423823140852341486978280600384698952734238074062902577652500585391487580874826442455039732779415904472209209498894936718548818900948145542742472902355204, 878087308766676484222131155557168549068068084167978627159968555913591142896749796404423646678320402115187459997898930552279030687215715494938123576110504, 46538627364633853663772951244529933100607608460902867239478333463420330573527739209434453273950981312104935379888643319270788626422432921231720549533856712, 2634261926300029452666393466671505647204204252503935881479905667740773428690249389213270940034961206345562379993696791656837092061647146484814370728331512, 139615882093901560991318853733589799301822825382708601718435000390260991720583217628303359821852943936314806139665929957812365879267298763695161648601570136, 7902785778900088357999180400014516941612612757511807644439717003222320286070748167639812820104883619036687139981090374970511276184941439454443112184994536, 418847646281704682973956561200769397905468476148125805155305001170782975161749652884910079465558831808944418418997789873437097637801896291085484945804710408, 1756174617533352968444262311114337098136136168335957254319937111827182285793499592808847293356640804230374919995797861104558061374431430989876247152221008, 93077254729267707327545902489059866201215216921805734478956666926840661147055478418868906547901962624209870759777286638541577252844865842463441099067713424, 5268523852600058905332786933343011294408408505007871762959811335481546857380498778426541880069922412691124759987393583313674184123294292969628741456663024, 279231764187803121982637707467179598603645650765417203436870000780521983441166435256606719643705887872629612279331859915624731758534597527390323297203140272, 15805571557800176715998360800029033883225225515023615288879434006444640572141496335279625640209767238073374279962180749941022552369882878908886224369989072, 837695292563409365947913122401538795810936952296251610310610002341565950323499305769820158931117663617888836837995579746874195275603792582170969891609420816, 3512349235066705936888524622228674196272272336671914508639874223654364571586999185617694586713281608460749839991595722209116122748862861979752494304442016, 186154509458535414655091804978119732402430433843611468957913333853681322294110956837737813095803925248419741519554573277083154505689731684926882198135426848, 10537047705200117810665573866686022588816817010015743525919622670963093714760997556853083760139844825382249519974787166627348368246588585939257482913326048, 558463528375606243965275414934359197207291301530834406873740001561043966882332870513213439287411775745259224558663719831249463517069195054780646594406280544, 31611143115600353431996721600058067766450451030047230577758868012889281144282992670559251280419534476146748559924361499882045104739765757817772448739978144, 1675390585126818731895826244803077591621873904592503220621220004683131900646998611539640317862235327235777673675991159493748390551207585164341939783218841632, 7024698470133411873777049244457348392544544673343829017279748447308729143173998371235389173426563216921499679983191444418232245497725723959504988608884032, 372309018917070829310183609956239464804860867687222937915826667707362644588221913675475626191607850496839483039109146554166309011379463369853764396270853696, 21074095410400235621331147733372045177633634020031487051839245341926187429521995113706167520279689650764499039949574333254696736493177171878514965826652096, 1116927056751212487930550829868718394414582603061668813747480003122087933764665741026426878574823551490518449117327439662498927034138390109561293188812561088, 63222286231200706863993443200116135532900902060094461155517736025778562288565985341118502560839068952293497119848722999764090209479531515635544897479956288, 3350781170253637463791652489606155183243747809185006441242440009366263801293997223079280635724470654471555347351982318987496781102415170328683879566437683264, 14049396940266823747554098488914696785089089346687658034559496894617458286347996742470778346853126433842999359966382888836464490995451447919009977217768064, 744618037834141658620367219912478929609721735374445875831653335414725289176443827350951252383215700993678966078218293108332618022758926739707528792541707392, 42148190820800471242662295466744090355267268040062974103678490683852374859043990227412335040559379301528998079899148666509393472986354343757029931653304192, 2233854113502424975861101659737436788829165206123337627494960006244175867529331482052853757149647102981036898234654879324997854068276780219122586377625122176, 126444572462401413727986886400232271065801804120188922311035472051557124577131970682237005121678137904586994239697445999528180418959063031271089794959912576, 6701562340507274927583304979212310366487495618370012882484880018732527602587994446158561271448941308943110694703964637974993562204830340657367759132875366528, 28098793880533647495108196977829393570178178693375316069118993789234916572695993484941556693706252867685998719932765777672928981990902895838019954435536128, 1489236075668283317240734439824957859219443470748891751663306670829450578352887654701902504766431401987357932156436586216665236045517853479415057585083414784, 84296381641600942485324590933488180710534536080125948207356981367704749718087980454824670081118758603057996159798297333018786945972708687514059863306608384, 4467708227004849951722203319474873577658330412246675254989920012488351735058662964105707514299294205962073796469309758649995708136553560438245172755250244352, 252889144924802827455973772800464542131603608240377844622070944103114249154263941364474010243356275809173988479394891999056360837918126062542179589919825152, 13403124681014549855166609958424620732974991236740025764969760037465055205175988892317122542897882617886221389407929275949987124409660681314735518265750733056, 56197587761067294990216393955658787140356357386750632138237987578469833145391986969883113387412505735371997439865531555345857963981805791676039908871072256, 2978472151336566634481468879649915718438886941497783503326613341658901156705775309403805009532862803974715864312873172433330472091035706958830115170166829568, 168592763283201884970649181866976361421069072160251896414713962735409499436175960909649340162237517206115992319596594666037573891945417375028119726613216768, 8935416454009699903444406638949747155316660824493350509979840024976703470117325928211415028598588411924147592938619517299991416273107120876490345510500488704, 505778289849605654911947545600929084263207216480755689244141888206228498308527882728948020486712551618347976958789783998112721675836252125084359179839650304, 26806249362029099710333219916849241465949982473480051529939520074930110410351977784634245085795765235772442778815858551899974248819321362629471036531501466112, 112395175522134589980432787911317574280712714773501264276475975156939666290783973939766226774825011470743994879731063110691715927963611583352079817742144512, 5956944302673133268962937759299831436877773882995567006653226683317802313411550618807610019065725607949431728625746344866660944182071413917660230340333659136, 337185526566403769941298363733952722842138144320503792829427925470818998872351921819298680324475034412231984639193189332075147783890834750056239453226433536, 17870832908019399806888813277899494310633321648986701019959680049953406940234651856422830057197176823848295185877239034599982832546214241752980691021000977408, 1011556579699211309823895091201858168526414432961511378488283776412456996617055765457896040973425103236695953917579567996225443351672504250168718359679300608, 53612498724058199420666439833698482931899964946960103059879040149860220820703955569268490171591530471544885557631717103799948497638642725258942073063002932224]

	res = []
	for x in a:
		for y in b:
			if x == y:
				print('guarda questi due sono uguali!', x)
				res.append(x)


	res.sort()
	print(res)
	return